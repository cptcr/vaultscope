<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:VaultScope.UI.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="VaultScope.UI.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">
    
    <Design.DataContext>
        <vm:SettingsViewModel />
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Classes="page-header">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0">
                    <TextBlock Classes="page-title" Text="Settings" />
                    <TextBlock Classes="page-subtitle" Text="Configure your VaultScope preferences" />
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                    <Button Classes="primary-button" Command="{Binding SaveSettingsCommand}"
                            IsEnabled="{Binding IsDirty}">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <Path Data="{StaticResource SaveIcon}" Fill="{DynamicResource PrimaryButtonForeground}" 
                                  Width="16" Height="16" />
                            <TextBlock Text="Save Changes" />
                        </StackPanel>
                    </Button>
                    <Button Classes="secondary-button" Command="{Binding ResetSettingsCommand}">
                        <TextBlock Text="Reset to Defaults" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel Spacing="20" MaxWidth="800">
                <!-- General Settings -->
                <Border Classes="card">
                    <StackPanel Spacing="20">
                        <TextBlock Classes="card-title" Text="General" />
                        
                        <!-- Theme Selection -->
                        <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="10">
                            <TextBlock Grid.Row="0" Text="Theme" Classes="input-label" />
                            <ComboBox Grid.Row="1" SelectedItem="{Binding SelectedTheme}" 
                                      Classes="modern-input" HorizontalAlignment="Stretch">
                                <ComboBoxItem>DarkPurple</ComboBoxItem>
                                <ComboBoxItem>DarkBlue</ComboBoxItem>
                                <ComboBoxItem>Light</ComboBoxItem>
                            </ComboBox>
                            <TextBlock Grid.Row="2" Text="Choose your preferred color theme"
                                       Classes="input-hint" />
                        </Grid>
                        
                        <!-- Notifications -->
                        <Border Background="{DynamicResource CardBackgroundDarker}" 
                                CornerRadius="8" Padding="15">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Enable Notifications" FontWeight="SemiBold" />
                                    <TextBlock Text="Show system notifications for important events"
                                               Classes="input-hint" />
                                </StackPanel>
                                <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableNotifications}" />
                            </Grid>
                        </Border>
                        
                        <!-- Sound Effects -->
                        <Border Background="{DynamicResource CardBackgroundDarker}" 
                                CornerRadius="8" Padding="15">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Enable Sound Effects" FontWeight="SemiBold" />
                                    <TextBlock Text="Play sounds for scan completion and alerts"
                                               Classes="input-hint" />
                                </StackPanel>
                                <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableSoundEffects}" />
                            </Grid>
                        </Border>
                        
                        <!-- Auto Save -->
                        <Border Background="{DynamicResource CardBackgroundDarker}" 
                                CornerRadius="8" Padding="15">
                            <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Enable Auto-Save" FontWeight="SemiBold" />
                                        <TextBlock Text="Automatically save scan results"
                                                   Classes="input-hint" />
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableAutoSave}" />
                                </Grid>
                                
                                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10"
                                      IsVisible="{Binding EnableAutoSave}">
                                    <TextBlock Grid.Column="0" Text="Save every" VerticalAlignment="Center" />
                                    <Slider Grid.Column="1" Minimum="60" Maximum="600" 
                                            Value="{Binding AutoSaveInterval}" />
                                    <TextBlock Grid.Column="2" Text="{Binding AutoSaveInterval, StringFormat='{}{0} seconds'}"
                                               VerticalAlignment="Center" MinWidth="80" />
                                </Grid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- Network Settings -->
                <Border Classes="card">
                    <StackPanel Spacing="20">
                        <TextBlock Classes="card-title" Text="Network" />
                        
                        <!-- SSL Validation -->
                        <Border Background="{DynamicResource CardBackgroundDarker}" 
                                CornerRadius="8" Padding="15">
                            <Grid ColumnDefinitions="*,Auto">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="SSL Certificate Validation" FontWeight="SemiBold" />
                                    <TextBlock Text="Validate SSL certificates (disable for self-signed certs)"
                                               Classes="input-hint" />
                                </StackPanel>
                                <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableSslValidation}" />
                            </Grid>
                        </Border>
                        
                        <!-- Request Timeout -->
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                            <TextBlock Grid.Row="0" Text="Request Timeout" Classes="input-label" />
                            <Grid Grid.Row="1" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <Slider Grid.Column="0" Minimum="5" Maximum="120" 
                                        Value="{Binding RequestTimeout}" />
                                <TextBlock Grid.Column="1" Text="{Binding RequestTimeout, StringFormat='{}{0} seconds'}"
                                           VerticalAlignment="Center" MinWidth="80" />
                            </Grid>
                        </Grid>
                        
                        <!-- Concurrent Requests -->
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                            <TextBlock Grid.Row="0" Text="Max Concurrent Requests" Classes="input-label" />
                            <Grid Grid.Row="1" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <Slider Grid.Column="0" Minimum="1" Maximum="50" 
                                        Value="{Binding MaxConcurrentRequests}" />
                                <TextBlock Grid.Column="1" Text="{Binding MaxConcurrentRequests}"
                                           VerticalAlignment="Center" MinWidth="40" />
                            </Grid>
                        </Grid>
                        
                        <!-- User Agent -->
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                            <TextBlock Grid.Row="0" Text="User Agent" Classes="input-label" />
                            <TextBox Grid.Row="1" Text="{Binding UserAgent}" Classes="modern-input" />
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- Proxy Settings -->
                <Border Classes="card">
                    <StackPanel Spacing="20">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Classes="card-title" Text="Proxy" />
                            <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableProxyDetection}" />
                        </Grid>
                        
                        <StackPanel Spacing="15" IsVisible="{Binding EnableProxyDetection}">
                            <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                                <TextBlock Grid.Row="0" Text="Proxy Address" Classes="input-label" />
                                <TextBox Grid.Row="1" Text="{Binding ProxyAddress}" 
                                         Watermark="e.g., proxy.company.com"
                                         Classes="modern-input" />
                            </Grid>
                            
                            <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                                <TextBlock Grid.Row="0" Text="Proxy Port" Classes="input-label" />
                                <NumericUpDown Grid.Row="1" Value="{Binding ProxyPort}" 
                                               Minimum="1" Maximum="65535"
                                               Classes="modern-input" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Database Settings -->
                <Border Classes="card">
                    <StackPanel Spacing="20">
                        <TextBlock Classes="card-title" Text="Database" />
                        
                        <!-- Auto Cleanup -->
                        <Border Background="{DynamicResource CardBackgroundDarker}" 
                                CornerRadius="8" Padding="15">
                            <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Enable Auto-Cleanup" FontWeight="SemiBold" />
                                        <TextBlock Text="Automatically remove old scan results"
                                                   Classes="input-hint" />
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableDatabaseCleanup}" />
                                </Grid>
                                
                                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10"
                                      IsVisible="{Binding EnableDatabaseCleanup}">
                                    <TextBlock Grid.Column="0" Text="Keep data for" VerticalAlignment="Center" />
                                    <Slider Grid.Column="1" Minimum="7" Maximum="365" 
                                            Value="{Binding DatabaseCleanupDays}" />
                                    <TextBlock Grid.Column="2" Text="{Binding DatabaseCleanupDays, StringFormat='{}{0} days'}"
                                               VerticalAlignment="Center" MinWidth="80" />
                                </Grid>
                            </Grid>
                        </Border>
                        
                        <!-- Database Size -->
                        <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="10">
                            <TextBlock Grid.Row="0" Text="Maximum Database Size" Classes="input-label" />
                            <TextBlock Grid.Row="1" Text="{Binding MaxDatabaseSizeMB}" FontSize="24" FontWeight="Bold" />
                            <Button Grid.Row="2" Classes="danger-button" Command="{Binding ClearDatabaseCommand}"
                                    HorizontalAlignment="Left">
                                <TextBlock Text="Clear Database" />
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- Import/Export -->
                <Border Classes="card">
                    <StackPanel Spacing="20">
                        <TextBlock Classes="card-title" Text="Import/Export" />
                        
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Button Classes="secondary-button" Command="{Binding ExportSettingsCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <Path Data="{StaticResource ExportIcon}" Fill="{DynamicResource SecondaryButtonForeground}" 
                                          Width="16" Height="16" />
                                    <TextBlock Text="Export Settings" />
                                </StackPanel>
                            </Button>
                            <Button Classes="secondary-button" Command="{Binding ImportSettingsCommand}">
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <Path Data="{StaticResource ImportIcon}" Fill="{DynamicResource SecondaryButtonForeground}" 
                                          Width="16" Height="16" />
                                    <TextBlock Text="Import Settings" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Unsaved Changes Warning -->
        <Border Grid.Row="2" Classes="warning-bar" IsVisible="{Binding IsDirty}"
                Margin="20,0,20,20">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                <Path Grid.Column="0" Data="{StaticResource WarningIcon}" Fill="{DynamicResource WarningColor}"
                      Width="20" Height="20" />
                <TextBlock Grid.Column="1" Text="You have unsaved changes" VerticalAlignment="Center" />
                <Button Grid.Column="2" Classes="primary-button" Command="{Binding SaveSettingsCommand}">
                    <TextBlock Text="Save Now" />
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>